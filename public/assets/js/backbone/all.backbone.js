Koob.Models.UsrSession=Backbone.Model.extend({url:"api/UsrSession"}); Koob.Models.HistoriaLectura=Backbone.Model.extend({url:"api/historiaLectura"}); Koob.Models.Historia=Backbone.Model.extend({url:"api/historias"}); Koob.Models.Post=Backbone.Model.extend({url:"api/posts"}); Koob.Collections.Historias=Backbone.Collection.extend({model:Koob.Models.Historia,url:"api/historias",name:"historias"}); Koob.Collections.Posts=Backbone.Collection.extend({model:Koob.Models.Post,url:"api/posts",name:"posts"}); Koob.Views.App=Backbone.View.extend({events:{"click .desplazar":"desplazar","click .registrar":"registrar","click .iniciar-sesion":"iniciarSesion","click .div-sesiones, .sesion-salir":"ocultarSesiones","click .div-iniciar-sesion, .div-registrar":"panelesSesiones"},initialize:function(i){this.$el=i},desplazar:function(i){i.preventDefault();var s=$(".desplazar").attr("href");$("body,html").stop(!0,!0).animate({scrollTop:$(s).offset().top},800)},registrar:function(i){i.stopPropagation(),$(".div-registrar").css("display","block"),$(".div-sesiones").fadeToggle(400)},iniciarSesion:function(i){i.stopPropagation(),$(".div-iniciar-sesion").css("display","block"),$(".div-sesiones").fadeToggle(400)},ocultarSesiones:function(i){i.stopPropagation(),$(".div-sesiones").fadeToggle(400),$(".div-registrar, .div-iniciar-sesion").css("display","none")},panelesSesiones:function(i){i.stopPropagation()}}); Koob.Views.Historia=Backbone.View.extend({initialize:function(){this.$el.css("display","inline-block"),this.render()},render:function(){this.template=_.template($("#historia-template").html());var t=this.model.toJSON(),e=this.template(t);this.$el.html(e)}}); Koob.Views.HistoriaLectura=Backbone.View.extend({events:{"click .agregar-fragmento":"agregar_fragmento","submit form":"guardar_fragmento","click .like":"like","click .dislike":"dislike"},agregar_fragmento:function(e){e.preventDefault(),$(".agregar-fragmento").slideToggle(),$(".div-historia-informacion2").slideToggle(),$(".div-agregar").slideToggle(),window.editor||(window.editor=new Quill("#textarea-agregar",{modules:{toolbar:{container:"#formatting-container"},"image-tooltip":!0,"link-tooltip":!0}}),editor.on("text-change",function(){$(".primer-post").val(editor.getHTML())}))},guardar_fragmento:function(e){e.preventDefault(),$(".agregar-fragmento").slideToggle(),$(".div-historia-informacion2").slideToggle(),$(".div-agregar").slideToggle();var i=editor.getHTML(),t=$("#idHistoria").val(),o=window.models.usrSession.toJSON()._id,a=1;_.max(window.collections.posts.toJSON(),function(e){a=e.numeroPost+1});var r={contenido:i,historia:t,autor:o,numeroPost:a},l=new Koob.Models.Post(r);l.save(),window.socket.emit("post message",{numero:r.numeroPost,idHistoria:r.historia}),editor.setHTML("")},initialize:function(){this.render()},render:function(){this.template=_.template($("#historiaLectura-template").html()),console.log(this.model.toJSON());var e=this.model.toJSON(),i=this.template(e);this.$el.html(i)},like:function(e){e.preventDefault(),data={_id:this.model.toJSON()._id,likes:this.model.toJSON().likes+1};var i=new Koob.Models.HistoriaLectura(data);i.save(),$(".like p").text(data.likes),console.log($(".like p").text())},dislike:function(e){e.preventDefault(),data={_id:this.model.toJSON()._id,dislikes:this.model.toJSON().dislikes+1};var i=new Koob.Models.HistoriaLectura(data);i.save(),$(".dislike p").text(data.dislikes),console.log($(".dislike p").text())}}); Koob.Views.Post=Backbone.View.extend({className:"post",initialize:function(){this.render()},eliminar:function(){console.log("Se a eliminado"),this.remove(function(){console.log("Se a eliminado un post")})},render:function(){this.template=_.template($("#post-template").html());var e=this.model.toJSON(),t=this.template(e);this.$el.html(t)}}); Koob.Views.Topbar=Backbone.View.extend({initialize:function(){this.render()},render:function(){this.template=_.template($("#topbar-template").html());var t=this.model.toJSON();$(".id").val(t._id);var e=this.template(t);this.$el.html(e)}});
